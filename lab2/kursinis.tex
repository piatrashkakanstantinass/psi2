\documentclass[
    english, % Klasei padavus parametrą 'english', darbas bus anglų kalba.
    % signatureplaces % prideda parašų vietas tituliniame puslapyje
]{VUMIFPSkursinis}
\usepackage{float}
\usepackage{wrapfig2}
\usepackage{hyperref}
\usepackage{algorithmicx}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{caption}
\usepackage{color}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{subcaption}
\usepackage{biblatex}
\usepackage{geometry}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{diagbox}
\usepackage{afterpage}
\usepackage{makecell}
\usepackage[inkscapelatex=false]{svg}
\renewcommand{\cftdotsep}{1} 


% Titulinio aprašas
\university{Vilnius university}
\faculty{Faculty of mathematics and informatics}
\department{Software engineering study program}
\papertype{Software Engineering II laboratory work 2}
\title{EduPal system architecture}
\status{2 course 5 group students}
\author{Motiejus Šveikauskas}
\secondauthor{Kanstantinas Piatrashka}
\thirdauthor{Aldas Vertelis}
\fourthauthor{Danielius Podbielski}
\reviewer{doc. dr. Vardauskas Pavardauskas}
\date{Vilnius – \the\year}

\bibliography{bibliografija}

\begin{document}
\maketitle

\tableofcontents

\section{Context}
EduPal is a learning aid system designed to enhance
the educational experience for both students and teachers. With a user-friendly interface and a comprehensive set of features, EduPal aims to streamline the learning process, fostering a more efficient and engaging educational environment.

\subsection{Functionality overview}

At present, EduPal has these functionalities:

\begin{itemize}
    \item \textbf{Creation and Management of Subjects}: Users have the ability to create new subjects and manage existing ones within the system. This includes creating topics under each subject and uploading conspectuses as files related to those topics.
    \item \textbf{Note taking}: Users can interact with notes by creating them, Users also have options to export notes to PDF and download.
    \item \textbf{Commenting}: Users can comment on topics in a live-updated comments section.
    \item \textbf{Pomodoro Timer System}: The system features a Pomodoro timer system designed to enhance productivity. Users can customize their study and break times according to their preferences. The timer notifies users when it's time to take a break, helping them maintain focus and manage their study sessions effectively.
    \item \textbf{Goal Setting}: Users can set study goals within the system, specifying desired subjects and study times. This feature starts a timer that counts the time spent learning and stops when the time limit is reached. This enables users to plan and organize their study sessions more efficiently, helping them stay on track with their academic or learning objectives.
    \item \textbf{Integration with ChatGPT}: The project integrates with Chat GPT, providing users with additional functionalities. This integration allows the system to store user chat history and respond to user inquiries using the capabilities of Chat GPT. Users can leverage this feature to seek assistance, clarify doubts, or engage in interactive conversations within the system.
\end{itemize}

\subsection{Tech stack and services}

The EduPal system was created using a modern technology stack to support its functionalities. The basic structure of the system:

\begin{itemize}
    \item \textbf{Frontend}: The frontend of the system is developed using the React framework and JavaScript with custom CSS. Communication with the backend is done using fetch api and SignalR client library.
    \item \textbf{Backend}: The system is built using ASP.NET Core 8 and follows a monolithic architecture. Entity Framework Core is used to interface the database. System also relies on Repository pattern to abstract data access. Backend exposes REST API and WebSocket endpoints, WebSocket communication is facilitated by SignalR. User authentication is managed by ASP.NET Identity and session is persisted using cookies.
          \item\textbf{Data Storage}: Conspectuses are stored locally within the application's file system. Upon upload, each conspectus is saved as a separate file in a local directory. When users request to download a conspectus, the application retrieves the corresponding file from this directory and streams it back as downloadable content. PostgreSQL is used as the main database management system.
    \item \textbf{OpenAI Service}: The system uses OpenAI API, to provide Chat GPT services. The prompt sent to Open AI is modified so that length of the response would be reasonable.
    \item \textbf{Tests}: System is tested using a combination of unit and integration tests.
    \item \textbf{Version Control and Hosting}: Git is used as version control system. Code is hosted on private GitLab instance that is also used for issues tracking.
\end{itemize}

\subsection{Selected requirements}
In this document we will focus on system changes needed to fulfil the follwing set of requirements:

\begin{itemize}
    \item \textbf{FR1.} Subject owner shall be able to toggle archivation state of the subject.
    \item \textbf{FR2.} Archived subject does not support adding, deleting or changing topics and uploaded conspectuses.
    \item \textbf{FR3.} System shall automatically archive subjects with no recent topic or conspectus changes after 1 month.
    \item \textbf{FR4.} Subject owner shall be notified about automatic archivation and given a week to cancel it.
    \item \textbf{FR5.} Users and administrators shall be able to be notified via system notification and email.
    \item \textbf{FR6.} Administrator shall be able to create other adminstrator accounts.
    \item \textbf{FR7.} Administrator creation and OpenAI limit setting actions shall be logged.
    \item \textbf{FR8.} Administrator shall be able to access OpenAI service usage statistics.
    \item \textbf{FR9.} Administrator shall be able to set OpenAI usage limits.
    \item \textbf{FR10.} System shall notify administrator if OpenAI usage exceeds limits.
    \item \textbf{FR11.} Users shall be able to leave feedback that administrators can access.
    \item \textbf{FR12.} Administrators shall be notified when users submit feedback.
\end{itemize}

\section{Logical View}

\subsection{Information model}

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/logical-view/informational.drawio.svg}
    \label{informational-model}
    \caption{Information model}
\end{figure}

\begin{description}
    \item[Subjects and topics] Subject is a primary organizational unit of the system. Subject is owned by user. Inside subjects there are topics. Last update timestamp is used by automatic archivation process and is updated whenever topics or conspectuses are updated or subject name is changed..
    \item[Conspectuses] Conspectuses are files stored in topics.
    \item[Accounts] System has 2 account types: user and administrator. User accounts are regular accounts used for interacting with the system and encapsulate student and teacher functionality. Administrator accounts are separate from user accounts and are only used for system administration.
    \item[Notifications] Notifications are sent to account and can be accessed in the UI (email message is sent as well). Subclasses are used to provide additional functionality, such as linking subject, so UI can display a button that redirects to subject page or offers a different set of controls.
    \item[ChatMessages] ChatMessages are stored for OpenAI chat.
    \item[AccountActions] System stores different types of account actions, currently only administrator related actions are stored but it may change in the future.
    \item[OpenAIStats] Object of this class is used by system to store token usage by day.
\end{description}

\subsection{Detailed subsystems}

\subsubsection{Data access classes}

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/logical-view/data-access.drawio.svg}
    \label{data-access-model}
    \caption{Data access diagram}
\end{figure}

EduPal uses Entity Framework Core ORM and PostgreSQL DBMS that impose certain restrictions on classes, instances of which need to be stored. Every class must have a primary key and it was decided to use Id string attribute. In order to abstract data access, repository pattern is used. Downside of such approach is that every class must extend BaseEntity class. In following model diagrams BaseEntity and Repository classes will be shown without attributes and methods. System settings are not stored in database, instead a json file is loaded when object is instantiated. SystemSettings class is injected as singleton. Usage of ASP.NET Identity allows all controllers to have access to account id from request context.

\subsubsection{Notification subsystem}

Other subsystems can send notifications via INotificationService interface. Its implementation is used to send email to account and send ping message using SignalR so that client can send request to get unread notifications. NotificationDto is used to send notifications to client and combines all subclasses into 1 class, client will use type attribute to determine what subclass to use.

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/logical-view/notification.drawio.svg}
    \label{notification-model}
    \caption{Notification subsystem diagram}
\end{figure}

\subsubsection{Archivation subsystem}

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/logical-view/archivation.drawio.svg}
    \caption{Archivation subsystem diagram}
    \label{archivation-model}
\end{figure}

System users can send archivation and unarchivation requests as well as access archived subjects. Updating archived subject would cause a fail. Automatic service is scheduled to perform automatic archivation every month and notify owner. Figure \ref{archivation-model} shows archivation subsystem diagram.

\subsubsection{Administration and feedback subsystem}

Figures \ref{administration-model} and \ref{feedback-model} shows administration and feedback subsystem diagrams. AccountController is capable of creating both administrator and regular users, process differs, as only administrator can create other administrator accounts.

Feedback is handled by feedback controller. User accounts are only able to submit feedback, while administrator accounts can access fedback from a particular date.

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/logical-view/administration.drawio.svg}
    \caption{Administration subsystem diagram}
    \label{administration-model}
\end{figure}

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/logical-view/feedback.drawio.svg}
    \caption{Feedback subsystem diagram}
    \label{feedback-model}
\end{figure}

\subsubsection{Architectural deficiencies}

EduPal software system was originally developed by a different team of software engineers leading to certain deficiencies that, while not critical, may obfuscate software growth and maintenance as codebase size increases. Core identified issue is \textbf{Lack of separation of layers}.

Many monolithic applications are developed following Domain Driven Design principles which dictate that there are 3 decoupled layer: Application, Infrastructure and Domain. Application layer depends on interfaces exposed by Domain layer and Infrastructure provides implementation for those interfaces. EduPal does not follow this architecture resulting in more tightly coupled codebase.

Despite such problem, considering current scale of aplication, such deficiency is not critical to application maintenance. However, in the future a need for a rewrite or restructurization may arise, therefore Stakeholders should be informed about it.

\section{Development View}

\section{Process View}

\subsection{Automatic subject archivation}

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/process-view/automatic-archivation.drawio.svg}
    \caption{Automatic subject archivation process diagram}
    \label{automatic-archivation-process}
\end{figure}

\subsection{Notification delivery}

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/process-view/notification-delivery.drawio.svg}
    \caption{Notification delivery process diagram}
    \label{notification-process}
\end{figure}

\section{Physical View}

\section{Use Case View}

\subsection{Subject archivation}

TODO

\subsection{Administration}

TODO: admin account creation, openai usage control


\subsection{Feedback collection}

TODO

\section{Traceability}

\newlength{\tablewidth}
\setlength{\tablewidth}{0.5\textwidth}

\newgeometry{
left=0.25\paperwidth-\tablewidth,
right=0.25\paperwidth-\tablewidth,
}
\renewcommand{\thead}[1]{\bfseries\makecell{#1}}

\begin{table}[htbp]
    \centering
    \begin{tabular}{|c|c|c|c|c|c|c|c|}
    \hline
    \multirow{3}{*}{\diagbox[dir=NW]{\textbf{Class}}{\textbf{Components}}} 
    & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} \\
    & \textbf{Web} & \thead{Notification \\ Systems} & \textbf{Admin UI} & \textbf{OpenAI} & \textbf{API} & \textbf{Feedback} & \textbf{Database} \\
    & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} \\
    \hline
    Conspectus & X & & & & & & X \\
    \hline
    Topic & X & & & & & & X \\
    \hline
    Subject & X & & & & & & X \\
    \hline
    User Account & X & & & & & & X \\
    \hline
    Admin Account & X & & X & & & & X \\
    \hline
    OpenAI Chat Message & X & & & X & X & & \\
    \hline
    Account & X & & & & & & X \\
    \hline
    Account Action & X & & X & & & & X \\
    \hline
    Administrator Creation Account & X & & X & & & & X \\
    \hline
    Notification & X & X & & & & & \\
    \hline
    Subject Archivation Notification & X & X & & & & & \\
    \hline
    Feedback Notification & X & X & & & & X & \\
    \hline
    OpenAI Usage Notification & X & X & & X & X & & \\
    \hline
    OpenAI Limit Change Action & & & & X & X & & \\
    \hline
    OpenAI Token Usage & & & & X & X & & X \\
    \hline
    System Settings & X & & X & & & & X \\
    \hline
    Feedback & X & & & & & X & X \\
    \hline
    \end{tabular}
    \caption{Traceability Table: Classes to Components}
    \end{table}
    
    \clearpage
    
    \begin{table}[htbp]
    \centering
    \begin{tabular}{|c|c|c|c|c|c|c|c|}
    \hline
    \multirow{3}{*}{\diagbox[dir=NW]{\textbf{Requirements}}{\textbf{Components}}} 
    & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} \\
    & \textbf{Web} & \thead{Notification \\ Systems} & \textbf{Admin UI} & \textbf{OpenAI} & \textbf{API} & \textbf{Feedback} & \textbf{Database} \\
    & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} \\
    \hline
    FR1 & X & & & & & & X \\
    \hline
    FR2 & X & & & & & & \\
    \hline
    FR3 & & X & & & & & \\
    \hline
    FR4 & & X & & & & & \\
    \hline
    FR5 & & & X & & & & \\
    \hline
    FR6 & & & X & X & X & & X \\
    \hline
    FR7 & & & X & X & & & X \\
    \hline
    FR8 & & & X & X & & & \\
    \hline
    FR9 & X & X & X & X & & X & \\
    \hline
    FR10 & X & X & & & X & X & \\
    \hline
    \end{tabular}
    \caption{Traceability Table: Requirements to Components}
    \end{table}
    
    \clearpage
    
    \begin{table}[htbp]
    \centering
    \begin{tabular}{|c|c|c|c|c|c|c|c|}
    \hline
    \multirow{3}{*}{\diagbox[dir=NW]{\textbf{Artifacts}}{\textbf{Components}}} 
    & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} \\
    & \textbf{Web} & \thead{Notification \\ Systems} & \textbf{Admin UI} & \textbf{OpenAI} & \textbf{API} & \textbf{Feedback} & \textbf{Database} \\
    & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} & \textbf{} \\
    \hline
    react-app.tgz & X & X & X & & & & \\
    \hline
    api.dll & & & & & X & & \\
    \hline
    db.sql & & & & & X & & X \\
    \hline
    \end{tabular}
    \caption{Artifact-Component Relationship}
    \end{table}
\restoregeometry

\listoffigures
\printbibliography[heading=bibintoc]

\end{document}

\documentclass[
    english, % Klasei padavus parametrą 'english', darbas bus anglų kalba.
    % signatureplaces % prideda parašų vietas tituliniame puslapyje
]{VUMIFPSkursinis}
\usepackage{float}
\usepackage{wrapfig2}
\usepackage{hyperref}
\usepackage{algorithmicx}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{caption}
\usepackage{color}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{subcaption}
\usepackage{biblatex}
\usepackage[inkscapelatex=false]{svg}
\renewcommand{\cftdotsep}{1} 


% Titulinio aprašas
\university{Vilnius university}
\faculty{Faculty of mathematics and informatics}
\department{Software engineering study program}
\papertype{Software Engineering II laboratory work 2}
\title{EduPal system architecture}
\status{2 course 5 group students}
\author{Motiejus Šveikauskas}
\secondauthor{Kanstantinas Piatrashka}
\thirdauthor{Aldas Vertelis}
\fourthauthor{Danielius Podbielski}
\reviewer{doc. dr. Vardauskas Pavardauskas}
\date{Vilnius – \the\year}

\bibliography{bibliografija}

\begin{document}
\maketitle

\tableofcontents

\section{Context}
EduPal is a learning aid system designed to enhance
the educational experience for both students and teachers. With a user-friendly interface and a comprehensive set of features, EduPal aims to streamline the learning process, fostering a more efficient and engaging educational environment.

\subsection{Functionality overview}
List features here

\subsection{Tech stack}
List tech stack here

\subsection{Selected requirements}
In this document we will focus on system changes needed to fulfill the following set of requirements:

\begin{itemize}
    \item \textbf{FR1.} Subject owner shall be able to archive and unarchive the subject. Archived subject does not support adding, deleting or changing topics and uploaded conspectuses.
    \item \textbf{FR2.} System shall automatically archive subjects with no recent topic or conspectus changes after 1 month.
    \item \textbf{FR3.} Subject owner shall be notified about automatic archivation.
    \item \textbf{FR4.} Users and administrators shall be able to be notified via system notification and email.
    \item \textbf{FR5.} Administrator shall be able create other adminstrator accounts.
    \item \textbf{FR6.} Administrator creation and OpenAI limit setting actions shall be logged.
    \item \textbf{FR7.} Administrator shall be able to access OpenAI service usage statistics.
    \item \textbf{FR8.} Administrator shall be able to set OpenAI usage limits.
    \item \textbf{FR9.} System shall notify administrator if OpenAI usage exceeds limits.
    \item \textbf{FR10.} Users shall be able to leave feedback that administrators can access. Administrators shall be notified.
\end{itemize}

\section{Logical View}

\subsection{Information model}

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/logical-view/informational.drawio.svg}
    \label{informational-model}
    \caption{Information model}
\end{figure}

\begin{description}
    \item[Subjects and topics] Subject is a primary organizational unit of the system. Subject is owned by user. Inside subjects there are topics. Last update timestamp is used by automatic archivation process and is updated whenever topics or conspectuses are updated or subject name is changed..
    \item[Conspectuses] Conspectuses are files stored in topics.
    \item[Accounts] System has 2 account types: user and administrator. User accounts are regular accounts used for interacting with the system and encapsulate student and teacher functionality. Administrator accounts are separate from user accounts and are only used for system administration.
    \item[Notifications] Notifications are sent to account and can be accessed in the UI (email message is sent as well). Subclasses are used to provide additional functionality, such as linking subject, so UI can display a button that redirects to subject page or offers a different set of controls.
    \item[ChatMessages] ChatMessages are stored for OpenAI chat.
    \item[AccountActions] System stores different types of account actions, currently only administrator related actions are stored but it may change in the future.
    \item[OpenAIStats] Object of this class is used by system to store token usage by day.
\end{description}

\subsection{Detailed subsystems}

\subsubsection{Data access classes}

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/logical-view/data-access.drawio.svg}
    \label{data-access-model}
    \caption{Data access diagram}
\end{figure}

EduPal uses Entity Framework Core ORM and PostgreSQL DBMS that impose certain restrictions on classes, instances of which need to be stored. Every class must have a primary key and it was decided to use Id string attribute. In order to abstract data access, repository pattern is used. Downside of such approach is that every class must extend BaseEntity class. In following model diagrams BaseEntity and Repository classes will be shown without attributes and methods. System settings are not stored in database, instead a json file is loaded when object is instantiated. SystemSettings class is injected as singleton. Usage of ASP.NET Identity allows all controllers to have access to account id from request context.

\subsubsection{Notification subsystem}

Other subsystems can send notifications via INotificationService interface. Its implementation is used to send email to account and send ping message using SignalR so that client can send request to get unread notifications. NotificationDto is used to send notifications to client and combines all subclasses into 1 class, client will use type attribute to determine what subclass to use.

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/logical-view/notification.drawio.svg}
    \label{notification-model}
    \caption{Notification subsystem diagram}
\end{figure}

\subsubsection{Archivation subsystem}

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/logical-view/archivation.drawio.svg}
    \caption{Archivation subsystem diagram}
    \label{archivation-model}
\end{figure}

System users can send archivation and unarchivation requests as well as access archived subjects. Updating archived subject would cause a fail. Automatic service is scheduled to perform automatic archivation every month and notify owner. Figure \ref{archivation-model} shows archivation subsystem diagram.

\subsubsection{Administration and feedback subsystem}

Figures \ref{administration-model} and \ref{feedback-model} shows administration and feedback subsystem diagrams. AccountController is capable of creating both administrator and regular users, process differs, as only administrator can create other administrator accounts.

Feedback is handled by feedback controller. User accounts are only able to submit feedback, while administrator accounts can access fedback from a particular date.

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/logical-view/administration.drawio.svg}
    \caption{Administration subsystem diagram}
    \label{administration-model}
\end{figure}

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/logical-view/feedback.drawio.svg}
    \caption{Feedback subsystem diagram}
    \label{feedback-model}
\end{figure}

\subsubsection{Architectural deficiencies}

EduPal software system was originally developed by a different team of software engineers leading to certain deficiencies that, while not critical, may obfuscate software growth and maintenance as codebase size increases. Core identified issue is \textbf{Lack of separation of layers}.

Many monolithic applications are developed following Domain Driven Design principles which dictate that there are 3 decoupled layer: Application, Infrastructure and Domain. Application layer depends on interfaces exposed by Domain layer and Infrastructure provides implementation for those interfaces. EduPal does not follow this architecture resulting in more tightly coupled codebase.

Despite such problem, considering current scale of aplication, such deficiency is not critical to application maintenance. However, in the future a need for a rewrite or restructurization may arise, therefore Stakeholders should be informed about it.

\section{Development View}

\section{Process View}

\section{Physical View}

\section{Use Case View}

\subsection{Subject archivation}

\subsubsection{Archive and unarchive subject}

\begin{figure}[ht]
    \centering
    \includesvg{../lab2diags/use-cases/archivation.drawio.svg}
    \label{archivation-use-case}
    \caption{Subject archivation and unarchivation use case diagram}
\end{figure}

\begin{description}
    \item[Actors] User
    \item[Requirements] FR1, FR11
    \item[Description] User can request subject archivation or unarchivation. In both cases system must check whether user is the owner of a particular subject. If that is the case, subject archivation state is updated, otherwise nothing happens.
\end{description}

\subsubsection{Automatic subject archivation}

\begin{figure}[ht]
    \centering
    \includesvg{../lab2diags/use-cases/automatic-archivation.drawio.svg}
    \label{automatic-archivation-use-case}
    \caption{Automatic subject archivation diagram}
\end{figure}

\begin{description}
    \item[Actors] User, System clock
    \item[Requirements] FR2, FR3, FR11
    \item[Description] System clock regularly initiates automatic archivation check process. All users who own subjects that were not updated in a specified amount of time will be notified about archivation. If they do not respond, their subject will be automatically archived.
\end{description}

\subsection{Administration}

\begin{figure}[ht]
    \centering
    \includesvg[width=\textwidth]{../lab2diags/use-cases/administration.drawio.svg}
    \label{administration-use-cases}
    \caption{Administration use cases}
\end{figure}

\subsubsection{Administrator account creation}

\begin{description}
    \item[Actors] Administrator
    \item[Requirements] FR4, FR5
    \item[Description] Administrator can create other administrator accounts. This action is logged.
\end{description}

\subsubsection{OpenAI usage control}

\begin{description}
    \item[Actors] Administrator
    \item[Requirements] FR5, FR6, FR7
    \item[Description] Administrator can view OpenAI usage (used tokens, price) and set limits. Action of setting limits is logged.
\end{description}

\subsubsection{Notification on OpenAI usage}

\begin{description}
    \item[Actors] Administrator, User
    \item[Requirements] FR8
    \item[Description] Every time a user uses OpenAI integration, system calculates usage and notifies administrator if it exceeds limits.
\end{description}

\subsubsection{Feedback collection}

\begin{description}
    \item[Actors] Administrator, User
    \item[Requirements] FR9
    \item[Description] Users can leave feedback that administrators have access to.
\end{description}

\section{Traceability}

\listoffigures
\printbibliography[heading=bibintoc]

\end{document}
